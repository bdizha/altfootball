function collage(){$(".gallery-images").collagePlus({fadeSpeed:300})}function setHeightFor(t){$(t).attr("style","");var e=$(t),i=Math.max.apply(Math,e.map(function(){return $(this).height()}).get());$(window).width()>1125&&$(t).attr("style","height: "+(i+40)+"px")}!function(t){t.fn.collagePlus=function(e){function i(e,i,a,s){for(var n=a.padding*(e.length-1)+e.length*e[0][3],r=a.albumWidth-n,l=r/(i-n),h=n,c=i<a.albumWidth,d=0;d<e.length;d++){var m=t(e[d][0]),g=Math.floor(e[d][1]*l),u=Math.floor(e[d][2]*l),p=!!(d<e.length-1);a.allowPartialLastRow===!0&&c===!0&&(g=e[d][1],u=e[d][2]),h+=g,!p&&h<a.albumWidth&&(a.allowPartialLastRow===!0&&c===!0?g=g:g+=a.albumWidth-h),g--;var f=m.is("img")?m:m.find("img");f.width(g),m.is("img")||m.width(g+e[d][3]),f.height(u),m.is("img")||m.height(u+e[d][4]),o(m,p,a),f.one("load",function(t){return function(){if("default"==a.effect)t.animate({opacity:"1"},{duration:a.fadeSpeed});else{if("vertical"==a.direction)var e=s<=10?s:10;else var e=d<=9?d+1:10;t.removeClass(function(t,e){return(e.match(/\beffect-\S+/g)||[]).join(" ")}),t.addClass(a.effect),t.addClass("effect-duration-"+e)}}}(m)).each(function(){this.complete&&t(this).trigger("load")})}}function o(t,e,i){var o={"margin-bottom":i.padding+"px","margin-right":e?i.padding+"px":"0px",display:i.display,"vertical-align":"bottom",overflow:"hidden"};return t.css(o)}function a(e){$img=t(e);var i=new Array;return i.w=parseFloat($img.css("border-left-width"))+parseFloat($img.css("border-right-width")),i.h=parseFloat($img.css("border-top-width"))+parseFloat($img.css("border-bottom-width")),i}return this.each(function(){var o=0,s=[],n=1,r=t(this);t.fn.collagePlus.defaults.albumWidth=r.width(),t.fn.collagePlus.defaults.padding=parseFloat(r.css("padding-left")),t.fn.collagePlus.defaults.images=r.children();var l=t.extend({},t.fn.collagePlus.defaults,e);l.images.each(function(e){var r=t(this),h=r.is("img")?r:t(this).find("img"),c="undefined"!=typeof h.data("width")?h.data("width"):h.width(),d="undefined"!=typeof h.data("height")?h.data("height"):h.height(),m=a(h);h.data("width",c),h.data("height",d);var g=Math.ceil(c/d*l.targetHeight),u=Math.ceil(l.targetHeight);s.push([this,g,u,m.w,m.h]),o+=g+m.w+l.padding,o>l.albumWidth&&0!=s.length&&(i(s,o-l.padding,l,n),delete o,delete s,o=0,s=[],n+=1),l.images.length-1==e&&0!=s.length&&(i(s,o,l,n),delete o,delete s,o=0,s=[],n+=1)})})},t.fn.collagePlus.defaults={targetHeight:400,fadeSpeed:"fast",display:"inline-block",effect:"default",direction:"vertical",allowPartialLastRow:!1}}(jQuery),+function(t){"use strict";function e(){this._activeZoom=this._initialScrollPosition=this._initialTouchPosition=this._touchMoveListener=null,this._$document=t(document),this._$window=t(window),this._$body=t(document.body),this._boundClick=t.proxy(this._clickHandler,this)}function i(e){this._fullHeight=this._fullWidth=this._overlay=this._targetImageWrap=null,this._targetImage=e,this._$body=t(document.body)}e.prototype.listen=function(){this._$body.on("click",'[data-action="zoom"]',t.proxy(this._zoom,this))},e.prototype._zoom=function(e){var o=e.target;if(o&&"IMG"==o.tagName&&!this._$body.hasClass("zoom-overlay-open"))return e.metaKey||e.ctrlKey?window.open(e.target.getAttribute("data-original")||e.target.src,"_blank"):void(o.width>=t(window).width()-i.OFFSET||(this._activeZoomClose(!0),this._activeZoom=new i(o),this._activeZoom.zoomImage(),this._$window.on("scroll.zoom",t.proxy(this._scrollHandler,this)),this._$document.on("keyup.zoom",t.proxy(this._keyHandler,this)),this._$document.on("touchstart.zoom",t.proxy(this._touchStart,this)),document.addEventListener?document.addEventListener("click",this._boundClick,!0):document.attachEvent("onclick",this._boundClick,!0),"bubbles"in e?e.bubbles&&e.stopPropagation():e.cancelBubble=!0))},e.prototype._activeZoomClose=function(t){this._activeZoom&&(t?this._activeZoom.dispose():this._activeZoom.close(),this._$window.off(".zoom"),this._$document.off(".zoom"),document.removeEventListener("click",this._boundClick,!0),this._activeZoom=null)},e.prototype._scrollHandler=function(e){null===this._initialScrollPosition&&(this._initialScrollPosition=t(window).scrollTop());var i=this._initialScrollPosition-t(window).scrollTop();Math.abs(i)>=40&&this._activeZoomClose()},e.prototype._keyHandler=function(t){27==t.keyCode&&this._activeZoomClose()},e.prototype._clickHandler=function(t){t.preventDefault?t.preventDefault():event.returnValue=!1,"bubbles"in t?t.bubbles&&t.stopPropagation():t.cancelBubble=!0,this._activeZoomClose()},e.prototype._touchStart=function(e){this._initialTouchPosition=e.touches[0].pageY,t(e.target).on("touchmove.zoom",t.proxy(this._touchMove,this))},e.prototype._touchMove=function(e){Math.abs(e.touches[0].pageY-this._initialTouchPosition)>10&&(this._activeZoomClose(),t(e.target).off("touchmove.zoom"))},i.OFFSET=80,i._MAX_WIDTH=2560,i._MAX_HEIGHT=4096,i.prototype.zoomImage=function(){var e=document.createElement("img");e.onload=t.proxy(function(){this._fullHeight=Number(e.height),this._fullWidth=Number(e.width),this._zoomOriginal()},this),e.src=this._targetImage.src},i.prototype._zoomOriginal=function(){this._targetImageWrap=document.createElement("div"),this._targetImageWrap.className="zoom-img-wrap",this._targetImage.parentNode.insertBefore(this._targetImageWrap,this._targetImage),this._targetImageWrap.appendChild(this._targetImage),t(this._targetImage).addClass("zoom-img").attr("data-action","zoom-out"),this._overlay=document.createElement("div"),this._overlay.className="zoom-overlay",document.body.appendChild(this._overlay),this._calculateZoom(),this._triggerAnimation()},i.prototype._calculateZoom=function(){this._targetImage.offsetWidth;var e=this._fullWidth,o=this._fullHeight,a=(t(window).scrollTop(),e/this._targetImage.width),s=t(window).height()-i.OFFSET,n=t(window).width()-i.OFFSET,r=e/o,l=n/s;e<n&&o<s?this._imgScaleFactor=a:r<l?this._imgScaleFactor=s/o*a:this._imgScaleFactor=n/e*a},i.prototype._triggerAnimation=function(){this._targetImage.offsetWidth;var e=t(this._targetImage).offset(),i=t(window).scrollTop(),o=i+t(window).height()/2,a=t(window).width()/2,s=e.top+this._targetImage.height/2,n=e.left+this._targetImage.width/2;this._translateY=Math.round(o-s),this._translateX=Math.round(a-n);var r="scale("+this._imgScaleFactor+")",l="translate("+this._translateX+"px, "+this._translateY+"px)";t.support.transition&&(l+=" translateZ(0)"),t(this._targetImage).css({"-webkit-transform":r,"-ms-transform":r,transform:r}),t(this._targetImageWrap).css({"-webkit-transform":l,"-ms-transform":l,transform:l}),this._$body.addClass("zoom-overlay-open")},i.prototype.close=function(){return this._$body.removeClass("zoom-overlay-open").addClass("zoom-overlay-transitioning"),t(this._targetImage).css({"-webkit-transform":"","-ms-transform":"",transform:""}),t(this._targetImageWrap).css({"-webkit-transform":"","-ms-transform":"",transform:""}),t.support.transition?void t(this._targetImage).one(t.support.transition.end,t.proxy(this.dispose,this)).emulateTransitionEnd(300):this.dispose()},i.prototype.dispose=function(){this._targetImageWrap&&this._targetImageWrap.parentNode&&(t(this._targetImage).removeClass("zoom-img").attr("data-action","zoom"),this._targetImageWrap.parentNode.replaceChild(this._targetImage,this._targetImageWrap),this._overlay.parentNode.removeChild(this._overlay),this._$body.removeClass("zoom-overlay-transitioning"))},t(function(){(new e).listen()})}(jQuery),$(function(){$("article.content img").attr("data-action","zoom"),$("img.captioned").each(function(){var t=$(this).attr("alt")||!1;t&&$(this).after('<p class="caption">'+t+"</p>")});var t=$("input.giant.search");t.focus().val(t.val()),$(window).load(function(){collage()}),$("#nav-main .search").focus(function(){$(this).addClass("grow")}).blur(function(){$(this).removeClass("grow")})});var resizeTimer=null;$(window).bind("resize",function(){$(".gallery-images img").css("opacity",0),resizeTimer&&clearTimeout(resizeTimer),resizeTimer=setTimeout(collage,200)}),$(function(){console.log("testing..."),setHeightFor("._3VSm9, ._1Q_Pu")});var resizeTimer=null;$(window).bind("resize",function(){setHeightFor("._3VSm9, ._1Q_Pu")});